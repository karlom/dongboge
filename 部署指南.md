# 东博哥博客部署指南

本指南将帮助你将Astro博客部署到腾讯云服务器，实现通过GitHub Actions自动化部署。

## 📋 部署架构

```
本地编写 → GitHub仓库 → GitHub Actions → 腾讯云服务器 → www.dongboge.cn
```

## 🚀 快速开始

### 1. 服务器环境配置

在你的腾讯云服务器上执行：

```bash
# 上传server-setup.sh到服务器
scp deploy/server-setup.sh root@你的服务器IP:/root/

# 登录服务器并执行
ssh root@你的服务器IP
chmod +x server-setup.sh
./server-setup.sh
```

### 2. GitHub仓库配置

1. **创建GitHub仓库**（如果还没有）
2. **添加Secrets**：在GitHub仓库设置中添加以下Secrets：
   - `HOST`: 你的服务器IP地址
   - `USERNAME`: 服务器用户名（通常是root或ubuntu）
   - `PRIVATE_KEY`: 服务器私钥内容（执行`cat ~/.ssh/id_rsa`获取）
   - `PORT`: SSH端口（通常是22）

### 3. SSL证书配置

在服务器上执行：

```bash
chmod +x deploy/ssl-setup.sh
./deploy/ssl-setup.sh
```

### 4. 域名解析配置

在你的域名管理面板中添加以下DNS记录：
- A记录：`dongboge.cn` → 你的服务器IP
- A记录：`www.dongboge.cn` → 你的服务器IP

### 5. 一键部署

在本地项目目录执行：

```bash
chmod +x deploy/one-click-deploy.sh
./deploy/one-click-deploy.sh
```

## 📁 项目结构

```
my-blog/
├── .github/workflows/
│   └── deploy.yml          # GitHub Actions配置
├── deploy/
│   ├── nginx.conf          # Nginx配置文件
│   ├── server-setup.sh     # 服务器环境配置脚本
│   ├── ssl-setup.sh        # SSL证书配置脚本
│   └── one-click-deploy.sh # 一键部署脚本
├── src/
│   └── content/posts/      # 你的博客文章
└── 部署指南.md             # 本文档
```

## 🔄 日常使用流程

1. **编写文章**：在`src/content/posts/`目录下创建新的`.md`文件
2. **本地预览**：运行`npm run dev`预览效果
3. **一键部署**：执行`./deploy/one-click-deploy.sh`

## 🛠️ 手动部署（备用方案）

如果自动部署失败，可以手动部署：

```bash
# 在服务器上执行
cd /var/www/dongboge
git pull origin main
npm ci
npm run build
sudo systemctl reload nginx
```

## 🔧 故障排除

### 1. GitHub Actions部署失败

- 检查Secrets是否正确配置
- 确认服务器SSH密钥配置正确
- 查看Actions日志获取详细错误信息

### 2. 网站无法访问

- 检查域名DNS解析是否生效
- 确认Nginx配置正确：`sudo nginx -t`
- 检查防火墙设置：`sudo ufw status`

### 3. SSL证书问题

- 重新运行SSL配置脚本
- 检查域名解析是否指向正确IP
- 确认80和443端口开放

## 📝 配置文件说明

### GitHub Actions配置 (`.github/workflows/deploy.yml`)
- 监听main分支的push事件
- 自动构建项目
- 通过SSH部署到服务器

### Nginx配置 (`deploy/nginx.conf`)
- HTTP自动重定向到HTTPS
- 静态文件缓存优化
- 安全头配置

## 🎯 优化建议

1. **性能优化**：
   - 启用Gzip压缩
   - 配置CDN加速
   - 优化图片资源

2. **安全加固**：
   - 定期更新系统和软件
   - 配置fail2ban防护
   - 使用非标准SSH端口

3. **监控告警**：
   - 配置服务器监控
   - 设置网站可用性监控
   - 配置SSL证书到期提醒

## 📞 技术支持

如果遇到问题，可以：
1. 查看GitHub Actions的部署日志
2. 检查服务器的Nginx错误日志：`sudo tail -f /var/log/nginx/error.log`
3. 查看系统日志：`sudo journalctl -f`

---

🎉 恭喜！你的博客现在可以通过 https://www.dongboge.cn 访问了！