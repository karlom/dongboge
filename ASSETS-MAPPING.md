# Assetsæ˜ å°„åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

è¿™ä¸ªåŠŸèƒ½è§£å†³äº†åšå®¢æ–‡ç« ä¸­å¼•ç”¨çš„å›¾ç‰‡åœ¨CDNä¸Šçš„è®¿é—®é—®é¢˜ã€‚å½“Astroæ„å»ºæ—¶ï¼Œ`src/assets/` ç›®å½•ä¸‹çš„å›¾ç‰‡ä¼šè¢«å¤„ç†å¹¶æ”¾åˆ° `_astro/` ç›®å½•ä¸‹ï¼ˆå¸¦hashçš„æ–‡ä»¶åï¼‰ï¼Œä½†åšå®¢æ–‡ç« ä¸­çš„ `heroImage` å¼•ç”¨çš„æ˜¯ `assets/` è·¯å¾„ã€‚

## å·¥ä½œåŸç†

1. **æ„å»ºé˜¶æ®µ**ï¼š
   - `src/assets/success.jpg` â†’ `dist/_astro/success.DnpSl9pE.jpg`

2. **CDNåŒæ­¥é˜¶æ®µ**ï¼š
   - ä¸Šä¼  `_astro/success.DnpSl9pE.jpg` åˆ°CDN
   - **è‡ªåŠ¨åˆ›å»ºæ˜ å°„**ï¼šå¤åˆ¶ä¸€ä»½åˆ° `assets/success.DnpSl9pE.jpg`

3. **è®¿é—®é˜¶æ®µ**ï¼š
   - åšå®¢å¼•ç”¨ï¼š`heroImage: "../../assets/success.jpg"`
   - å®é™…è®¿é—®ï¼š`https://cdn.dongboge.cn/assets/success.DnpSl9pE.jpg`

## å®ç°ç»†èŠ‚

### ä¿®æ”¹çš„æ–‡ä»¶

- `scripts/modules/cdn-sync.js` - æ·»åŠ äº†assetsæ˜ å°„é€»è¾‘
- `.gitignore` - å¿½ç•¥æœ¬åœ°æ¸…å•æ–‡ä»¶

### æ–°å¢çš„åŠŸèƒ½

1. **`createAssetsMapping()` å‡½æ•°**ï¼š
   - æ£€æµ‹ä¸Šä¼ çš„æ–‡ä»¶ä¸­çš„ `_astro/` å›¾ç‰‡
   - ä½¿ç”¨COSçš„ `putObjectCopy` APIåˆ›å»ºæ˜ å°„
   - ç»´æŠ¤æ˜ å°„è®°å½•é¿å…é‡å¤æ“ä½œ

2. **æ˜ å°„è®°å½•æ–‡ä»¶**ï¼š
   - `.assets-mapping-manifest.json` - è®°å½•å·²åˆ›å»ºçš„æ˜ å°„
   - é¿å…é‡å¤åˆ›å»ºç›¸åŒçš„æ˜ å°„

### å·¥ä½œæµç¨‹

```
ä¸Šä¼ æ–‡ä»¶åˆ°CDN
    â†“
æ£€æµ‹_astroç›®å½•ä¸‹çš„å›¾ç‰‡æ–‡ä»¶
    â†“
æ£€æŸ¥æ˜ å°„è®°å½•ï¼Œé¿å…é‡å¤
    â†“
ä½¿ç”¨putObjectCopyåˆ›å»ºassetsæ˜ å°„
    â†“
æ›´æ–°æ˜ å°„è®°å½•
```

## ä½¿ç”¨æ–¹å¼

åŠŸèƒ½å·²é›†æˆåˆ°ç°æœ‰çš„ `simple-deploy` å·¥ä½œæµä¸­ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚å½“æœ‰å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ åˆ°CDNæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºassetsæ˜ å°„ã€‚

## æ—¥å¿—è¾“å‡º

éƒ¨ç½²æ—¶ä¼šçœ‹åˆ°ç±»ä¼¼çš„æ—¥å¿—ï¼š

```
ğŸ”— æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›å»ºassetsæ˜ å°„...
ğŸ“‹ å‘ç° 2 ä¸ª_astroå›¾ç‰‡æ–‡ä»¶éœ€è¦æ£€æŸ¥æ˜ å°„
  ğŸ“¤ åˆ›å»ºæ˜ å°„: _astro/success.DnpSl9pE.jpg -> assets/success.DnpSl9pE.jpg
  âœ… æ˜ å°„åˆ›å»ºæˆåŠŸ: assets/success.DnpSl9pE.jpg
âœ… åˆ›å»ºäº† 1 ä¸ªassetsæ˜ å°„
```

## æ•…éšœæ’é™¤

1. **æ˜ å°„åˆ›å»ºå¤±è´¥**ï¼šæ£€æŸ¥COSæƒé™å’Œç½‘ç»œè¿æ¥
2. **é‡å¤åˆ›å»ºæ˜ å°„**ï¼šæ£€æŸ¥ `.assets-mapping-manifest.json` æ–‡ä»¶æ˜¯å¦æ­£å¸¸
3. **å›¾ç‰‡ä»ç„¶æ— æ³•è®¿é—®**ï¼šæ£€æŸ¥CDNç¼“å­˜ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…ç¼“å­˜åˆ·æ–°

## æ£€æŸ¥å’Œç»´æŠ¤

### æ£€æŸ¥æ˜ å°„çŠ¶æ€

```bash
npm run assets:check
# æˆ–è€…
node scripts/check-cdn-assets-mapping.js
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š

- åˆ—å‡ºCDNä¸Š `_astro/` ç›®å½•ä¸‹çš„æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶
- æ£€æŸ¥å¯¹åº”çš„ `assets/` æ˜ å°„æ˜¯å¦å­˜åœ¨
- æ˜¾ç¤ºè¯¦ç»†çš„æ˜ å°„çŠ¶æ€æŠ¥å‘Š
- è¯†åˆ«ç¼ºå¤±çš„æ˜ å°„

### ä¿®å¤ç¼ºå¤±çš„æ˜ å°„

```bash
npm run assets:fix
# æˆ–è€…
node scripts/fix-missing-assets-mapping.js
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š

- è‡ªåŠ¨ä¸ºç¼ºå¤±çš„æ˜ å°„åˆ›å»ºCOSå¤åˆ¶
- æ›´æ–°æœ¬åœ°æ˜ å°„æ¸…å•
- æ˜¾ç¤ºä¿®å¤ç»“æœç»Ÿè®¡

### æµ‹è¯•åŠŸèƒ½

```bash
npm run assets:test
# æˆ–è€…
node scripts/test-assets-mapping.js
```

## ç»´æŠ¤å»ºè®®

1. **å®šæœŸæ£€æŸ¥**ï¼šå»ºè®®å®šæœŸè¿è¡Œ `npm run assets:check` æ£€æŸ¥æ˜ å°„çŠ¶æ€
2. **éƒ¨ç½²åéªŒè¯**ï¼šæ¯æ¬¡éƒ¨ç½²åå¯ä»¥è¿è¡Œæ£€æŸ¥å‘½ä»¤ç¡®è®¤æ–°å›¾ç‰‡å·²æ­£ç¡®æ˜ å°„
3. **æ¸…å•å¤‡ä»½**ï¼š`.assets-mapping-manifest.json` æ–‡ä»¶åŒ…å«é‡è¦çš„æ˜ å°„è®°å½•ï¼Œå»ºè®®å®šæœŸå¤‡ä»½
