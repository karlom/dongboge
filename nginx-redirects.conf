# Nginx重定向配置 - 处理WordPress到Astro的URL迁移
# 将此配置添加到你的nginx服务器配置中

# 处理WordPress的日期格式文章链接
# 例如: /2024/01/15/article-name/ -> /blog/article-name/
location ~ ^/(\d{4})/(\d{2})/(\d{2})/([^/]+)/?$ {
    return 301 /blog/$4/;
}

# 处理WordPress的分类页面
# 例如: /category/tech/ -> /blog/
location ~ ^/category/([^/]+)/?$ {
    return 301 /blog/;
}

# 处理WordPress的标签页面
# 例如: /tag/ai/ -> /blog/
location ~ ^/tag/([^/]+)/?$ {
    return 301 /blog/;
}

# 处理WordPress的作者页面
# 例如: /author/dongbo/ -> /about/
location ~ ^/author/([^/]+)/?$ {
    return 301 /about/;
}

# 处理WordPress的归档页面
# 例如: /2024/01/ -> /blog/
location ~ ^/(\d{4})/(\d{2})/?$ {
    return 301 /blog/;
}

# 处理WordPress的年份归档
# 例如: /2024/ -> /blog/
location ~ ^/(\d{4})/?$ {
    return 301 /blog/;
}

# 处理WordPress的搜索页面
# 例如: /?s=keyword -> /blog/
location ~ ^/\?s=(.*)$ {
    return 301 /blog/;
}

# 处理WordPress的页面链接（如果有的话）
# 例如: /about-us/ -> /about/
location = /about-us/ {
    return 301 /about/;
}

location = /contact-us/ {
    return 301 /contact/;
}

location = /services/ {
    return 301 /services/;
}

# 处理WordPress的管理和系统文件
location ~ ^/wp-admin/(.*)$ {
    return 301 /;
}

location ~ ^/wp-content/(.*)$ {
    return 301 /;
}

location ~ ^/wp-includes/(.*)$ {
    return 301 /;
}

location ~ ^/wp-json/(.*)$ {
    return 301 /;
}

# 处理WordPress的登录页面
location = /wp-login.php {
    return 301 /;
}

# 处理WordPress的注册页面
location = /wp-register.php {
    return 301 /;
}

# 处理WordPress的RSS订阅（重定向到新的RSS）
location = /feed/ {
    return 301 /rss.xml;
}

location = /rss/ {
    return 301 /rss.xml;
}

location = /atom/ {
    return 301 /rss.xml;
}

# 处理WordPress的评论RSS
location ~ ^/comments/feed/?$ {
    return 301 /rss.xml;
}

# 处理WordPress的trackback
location ~ ^/(.+)/trackback/?$ {
    return 301 /blog/;
}

# 处理WordPress的附件页面
location ~ ^/(.+)/attachment/(.+)/?$ {
    return 301 /blog/;
}

# 处理WordPress的分页
location ~ ^/page/(\d+)/?$ {
    return 301 /blog/;
}

# 处理WordPress的评论分页
location ~ ^/(.+)/comment-page-(\d+)/?$ {
    return 301 /blog/$1/;
}

# 处理常见的WordPress插件路径
location ~ ^/wp-content/plugins/(.*)$ {
    return 301 /;
}

location ~ ^/wp-content/themes/(.*)$ {
    return 301 /;
}

location ~ ^/wp-content/uploads/(.*)$ {
    # 如果有上传的文件需要保留，可以设置为404或者重定向到新的资源位置
    return 404;
}

# 处理PHP文件（WordPress遗留）
location ~ \.php$ {
    return 301 /;
}

# 处理WordPress的XML-RPC
location = /xmlrpc.php {
    return 301 /;
}

# 处理WordPress的robots.txt（如果有冲突）
location = /robots.txt {
    # 让Astro的robots.txt正常工作
    try_files $uri $uri/ =404;
}

# 处理WordPress的sitemap（重定向到新的sitemap）
location = /sitemap.xml {
    try_files $uri $uri/ =404;
}

location = /sitemap_index.xml {
    return 301 /sitemap-index.xml;
}

# 处理WordPress的favicon（如果路径不同）
location = /favicon.ico {
    try_files $uri /Favicon.png;
}

# 通用的WordPress文件处理
location ~ ^/(readme|license|changelog)\.txt$ {
    return 301 /;
}

# 处理WordPress的安装文件
location ~ ^/wp-(admin|includes|content)/ {
    return 301 /;
}

# 记录重定向日志（可选，用于调试）
# access_log /var/log/nginx/redirects.log;
# error_log /var/log/nginx/redirect_errors.log;