# 🚀 生产环境部署指南

## 📋 部署前检查清单

### ✅ 代码准备

- [x] 敏感文件已清理
- [x] 调试脚本已删除
- [x] 硬编码密钥已移除
- [x] .gitignore已更新

### ✅ 功能验证

- [x] 表单提交功能正常
- [x] 数据库存储正常
- [x] 飞书通知正常
- [x] 管理后台正常
- [x] 权限控制正确

## 🔐 GitHub Secrets 配置

在GitHub仓库的 Settings > Secrets and variables > Actions 中添加以下环境变量：

### 必需的Secrets

```bash
# Supabase配置
PUBLIC_SUPABASE_URL=https://znxjpdlohgjdhphcsmju.supabase.co
PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpueGpwZGxvaGdqZGhwaGNzbWp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNzgzNTEsImV4cCI6MjA2OTg1NDM1MX0.j6Q3ZtQiR8UAfsUEFPrfenrS_2-2zBKN5WZ1ysLXav4

# 腾讯云配置（已有）
TENCENT_SECRET_ID=你的腾讯云SecretId
TENCENT_SECRET_KEY=你的腾讯云SecretKey
TENCENT_COS_BUCKET=你的COS存储桶名称
CDN_DOMAIN=cdn.dongboge.cn

# 服务器配置（已有）
HOST=你的服务器IP
USERNAME=你的SSH用户名
SSH_PRIVATE_KEY=你的SSH私钥
SSH_PASSPHRASE=你的SSH私钥密码（如果有）
PORT=22
```

## 🔧 部署步骤

### 1. 设置GitHub Secrets

1. 进入GitHub仓库
2. 点击 Settings > Secrets and variables > Actions
3. 点击 "New repository secret"
4. 逐一添加上述所有secrets

### 2. 推送代码触发部署

```bash
git add .
git commit -m "feat: 添加Supabase联系表单功能和飞书通知"
git push origin main
```

### 3. 监控部署过程

1. 在GitHub仓库的 Actions 标签页查看部署进度
2. 确保所有步骤都成功执行
3. 检查是否有错误信息

## 🧪 部署后验证

### 1. 功能测试

- [ ] 访问生产环境网站：https://www.dongboge.cn/contact
- [ ] 提交测试表单
- [ ] 确认飞书收到通知
- [ ] 在Supabase中确认数据已保存

### 2. 管理后台测试

- [ ] 访问：https://www.dongboge.cn/admin/contact-submissions
- [ ] 使用管理员账户登录
- [ ] 确认可以查看提交的数据
- [ ] 测试状态更新功能

### 3. 性能检查

- [ ] 页面加载速度正常
- [ ] 表单提交响应及时
- [ ] 移动端显示正常

## 🔍 故障排除

### 常见问题及解决方案

#### 1. 环境变量未生效

**症状**: 网站显示"Missing Supabase environment variables"错误
**解决**: 检查GitHub Secrets是否正确设置，变量名是否完全匹配

#### 2. 表单提交失败

**症状**: 提交表单时显示401或其他错误
**解决**:

- 检查Supabase RLS策略是否正确
- 确认anon key是否有效
- 检查网络连接

#### 3. 飞书通知未收到

**症状**: 表单提交成功但飞书群没有收到通知
**解决**:

- 检查飞书Webhook URL是否正确
- 确认触发器是否正常工作
- 查看Supabase日志

#### 4. 管理后台无法访问

**症状**: 管理后台登录失败或无法加载数据
**解决**:

- 确认管理员账户是否正确创建
- 检查RLS策略中的authenticated权限
- 验证用户认证流程

## 📊 监控和维护

### 1. 定期检查

- 每周检查表单提交数量
- 监控Supabase使用量
- 检查飞书通知是否正常

### 2. 数据备份

- Supabase自动备份已启用
- 建议定期导出重要数据
- 保持数据库结构文档更新

### 3. 安全维护

- 定期更新依赖包
- 监控API使用情况
- 检查访问日志异常

## 🎯 部署成功标志

当以下所有项目都正常工作时，部署即为成功：

- ✅ 网站正常访问
- ✅ 联系表单可以提交
- ✅ 数据正确保存到Supabase
- ✅ 飞书通知正常接收
- ✅ 管理后台可以登录和管理数据
- ✅ 移动端显示正常
- ✅ 所有页面加载速度正常

---

## 🎉 恭喜！

完成部署后，你的网站将具备完整的客户咨询管理系统，可以开始接收真实的客户咨询了！

如有任何问题，请检查GitHub Actions的部署日志或联系技术支持。
