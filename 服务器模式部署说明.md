# ğŸš€ Astro æœåŠ¡å™¨æ¨¡å¼éƒ¨ç½²è¯´æ˜

## ğŸ“‹ éƒ¨ç½²æ¶æ„å˜æ›´

### ä¹‹å‰ï¼ˆé™æ€æ¨¡å¼ï¼‰

```
GitHub â†’ æ„å»ºé™æ€æ–‡ä»¶ â†’ ä¸Šä¼ åˆ°æœåŠ¡å™¨ â†’ Nginxç›´æ¥æœåŠ¡HTML
```

### ç°åœ¨ï¼ˆæœåŠ¡å™¨æ¨¡å¼ï¼‰

```
GitHub â†’ æ„å»ºå®¢æˆ·ç«¯+æœåŠ¡ç«¯ â†’ éƒ¨ç½²åˆ°æœåŠ¡å™¨ â†’ Node.jsæœåŠ¡å™¨ + Nginxä»£ç†
```

## ğŸ”§ å…³é”®å˜æ›´

### 1. æ„å»ºè¾“å‡ºç»“æ„

```
dist/
â”œâ”€â”€ client/          # é™æ€æ–‡ä»¶ï¼ˆHTMLã€CSSã€JSã€å›¾ç‰‡ç­‰ï¼‰
â””â”€â”€ server/          # Node.jsæœåŠ¡å™¨ä»£ç 
    â”œâ”€â”€ entry.mjs    # æœåŠ¡å™¨å…¥å£æ–‡ä»¶
    â””â”€â”€ pages/       # æœåŠ¡ç«¯é¡µé¢å’ŒAPIç«¯ç‚¹
```

### 2. éƒ¨ç½²æµç¨‹

1. **å®¢æˆ·ç«¯æ–‡ä»¶** â†’ `/var/www/dongboge/` (Nginxç›´æ¥æœåŠ¡)
2. **æœåŠ¡ç«¯æ–‡ä»¶** â†’ `/var/www/dongboge/server/` (Node.jsè¿è¡Œ)
3. **å¯åŠ¨Node.jsæœåŠ¡å™¨** â†’ `node server/entry.mjs`
4. **Nginxä»£ç†é…ç½®** â†’ APIå’ŒåŠ¨æ€é¡µé¢ä»£ç†åˆ°Node.js

### 3. Nginxé…ç½®æ›´æ–°

- **é™æ€æ–‡ä»¶**: ç›´æ¥ç”±NginxæœåŠ¡
- **APIç«¯ç‚¹** (`/api/*`): ä»£ç†åˆ°Node.js (ç«¯å£3000)
- **ç®¡ç†åå°** (`/admin/*`): ä»£ç†åˆ°Node.js
- **è”ç³»è¡¨å•** (`/contact`): ä»£ç†åˆ°Node.js

## ğŸ” æ•…éšœæ’é™¤

### 403 Forbidden é”™è¯¯

**åŸå› **:

- Nginxé…ç½®æœªæ›´æ–°
- Node.jsæœåŠ¡å™¨æœªå¯åŠ¨
- æ–‡ä»¶æƒé™é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ£€æŸ¥Node.jsæœåŠ¡å™¨çŠ¶æ€
ps aux | grep "node.*server/entry.mjs"

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t

# é‡å¯æœåŠ¡
sudo systemctl restart nginx

# æ‰‹åŠ¨å¯åŠ¨Node.jsæœåŠ¡å™¨
cd /var/www/dongboge
node server/entry.mjs
```

### éƒ¨ç½²å¤ªå¿«é—®é¢˜

**åŸå› **:

- ç¼“å­˜å‘½ä¸­å¯¼è‡´è·³è¿‡æ„å»ºæ­¥éª¤
- ä¸Šä¼ è„šæœ¬è¶…æ—¶è¢«è·³è¿‡

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥GitHub Actionsæ—¥å¿—
- æ¸…é™¤ç¼“å­˜é‡æ–°éƒ¨ç½²
- ç¡®ä¿æ‰€æœ‰æ­¥éª¤æ­£å¸¸æ‰§è¡Œ

## ğŸ“Š éƒ¨ç½²éªŒè¯æ¸…å•

éƒ¨ç½²å®Œæˆåæ£€æŸ¥ï¼š

- [ ] **ç½‘ç«™é¦–é¡µ**: https://www.dongboge.cn
- [ ] **é™æ€é¡µé¢**: https://www.dongboge.cn/about
- [ ] **åšå®¢é¡µé¢**: https://www.dongboge.cn/blog
- [ ] **è”ç³»è¡¨å•**: https://www.dongboge.cn/contact
- [ ] **APIç«¯ç‚¹**: https://www.dongboge.cn/api/contact (POSTè¯·æ±‚)
- [ ] **ç®¡ç†åå°**: https://www.dongboge.cn/admin/contact-submissions
- [ ] **Node.jsè¿›ç¨‹**: `ps aux | grep node`
- [ ] **NginxçŠ¶æ€**: `sudo systemctl status nginx`

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### 1. è¿›ç¨‹ç®¡ç†

å»ºè®®ä½¿ç”¨PM2ç®¡ç†Node.jsè¿›ç¨‹ï¼š

```bash
npm install -g pm2
pm2 start server/entry.mjs --name "dongboge-blog"
pm2 startup
pm2 save
```

### 2. ç›‘æ§å’Œæ—¥å¿—

```bash
# æŸ¥çœ‹Node.jsæ—¥å¿—
tail -f server.log

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# æŸ¥çœ‹PM2çŠ¶æ€
pm2 status
pm2 logs dongboge-blog
```

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä¸´æ—¶å›æ»šåˆ°é™æ€æ¨¡å¼ï¼š

1. **ä¿®æ”¹astro.config.mjs**:

```javascript
export default defineConfig({
  output: "static", // æ”¹å›é™æ€æ¨¡å¼
  // ç§»é™¤adapteré…ç½®
});
```

2. **é‡æ–°éƒ¨ç½²**:

```bash
git add astro.config.mjs
git commit -m "rollback: ä¸´æ—¶å›æ»šåˆ°é™æ€æ¨¡å¼"
git push origin main
```

3. **æ¢å¤Nginxé…ç½®**:
   ä½¿ç”¨ä¹‹å‰çš„é™æ€æ¨¡å¼Nginxé…ç½®æ–‡ä»¶ã€‚

---

## âœ… æ€»ç»“

æœåŠ¡å™¨æ¨¡å¼éƒ¨ç½²æ›´å¤æ‚ï¼Œä½†æä¾›äº†ï¼š

- âœ… APIç«¯ç‚¹æ”¯æŒ
- âœ… æœåŠ¡ç«¯æ¸²æŸ“
- âœ… åŠ¨æ€åŠŸèƒ½
- âœ… æ•°æ®åº“é›†æˆ

ç¡®ä¿æ‰€æœ‰é…ç½®æ­£ç¡®åï¼Œç½‘ç«™å°†æ­£å¸¸è¿è¡Œå¹¶æ”¯æŒè”ç³»è¡¨å•åŠŸèƒ½ã€‚
